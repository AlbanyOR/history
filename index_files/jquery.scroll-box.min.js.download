(function(c){var b=false;var d="scrollbox";var a={init:function(h){var n=this;if(a.isSet.call(this)){a.unset.call(this)}var C=c.extend({scrollColor:"#74808b",zIndex:100,margin:2,animation:true,stopOnLeave:false,isDraggable:true,onDragSelect:false,minDrag:10},h);n.data("scrollbox_settings",C);var l={},k={position:"absolute",backgroundColor:C.scrollColor,borderRadius:"5px",opacity:0.5,cursor:"pointer",width:"10px",height:"10px",display:"none",top:C.margin,left:C.margin},r=0,s=0,v=n.get(0),B=v.scrollHeight,i=v.clientHeight,m=v.scrollWidth,y=v.clientWidth,e=n.scrollTop(),u=n.scrollLeft();if(B==0&&m==0){n.parents().each(function(D){var p=c(this);if(p.css("display")=="none"){p.css("display","block").addClass("is-temporary-showed")}});B=v.scrollHeight;i=v.clientHeight;m=v.scrollWidth;y=v.clientWidth}c(".is-temporary-showed").removeClass("is-temporary-showed").css({display:"none"});if(B!==i){r=n.outerWidth()-y}if(m!==y){s=n.outerHeight()-i}if(s>0||r>0){var t;n.data("scrollbox_position",n.css("position"));n.data("scrollbox_overflow",n.css("overflow"));var q={};if(n.css("position")=="static"){q.position="relative"}n.wrapInner('<div class="scrollbox-container" />');t=n.children("div.scrollbox-container");t.css({position:"absolute",left:0,top:0,width:y-parseInt(n.css("padding-left"))-parseInt(n.css("padding-right")),height:i-parseInt(n.css("padding-top"))-parseInt(n.css("padding-bottom")),overflow:"hidden"});if(typeof(C.scrollTop)=="number"&&typeof(C.scrollLeft)=="number"){t.scrollTop(a._limit(C.scrollTop,0,B-i));t.scrollLeft(a._limit(C.scrollLeft,0,m-y))}else{t.scrollTop(e);t.scrollLeft(u)}var j=["paddingLeft","paddingRight","paddingTop","paddingBottom"];for(var o in j){if(n.css(j[o])){t.css(j[o],n.css(j[o]))}}q.overflow="hidden";n.css(q);if(r>0){var f=(i-C.margin*2)/B,x,w;if(f<1){if(n.children("div.scrollbox-bar-y").length==0){x=c('<div class="scrollbox-bar-y" />').css(k);n.append(x);w=c('<div class="scrollbox-handle-y" />').css(k);n.append(w)}else{x=n.children("div.scrollbox-bar-y").eq(0);w=n.children("div.scrollbox-handle-y").eq(0)}x.unbind("click mouseover mouseleave").bind("click",function(D){var E=D.pageY-c(this).offset().top<w.position().top?-1:1,p=a._limit(t.scrollTop()+i*E,0,B-i);a._setObjScroll.call(n,{scrollTop:p},C.animation,true);a._setScrollHandel.call(n,w,{top:C.margin+p*f},false)}).bind("mouseover",function(){c(this).stop().fadeTo(200,0.5)}).bind("mouseleave",function(){c(this).stop().fadeTo(200,0.3)}).css({opacity:0.3});w.unbind("mousedown  mouseover mouseleave").bind("mousedown",function(p){p.preventDefault();var D=p.screenY-w.position().top;c(document).bind("mousemove."+d,function(G){var F=a._limit(G.screenY-D,C.margin,i-C.margin-w.height()),E=a._limit((G.screenY-D)/f,0,B-i);a._setObjScroll.call(n,{scrollTop:E},C.animation,true);a._setScrollHandel.call(n,w,{top:F},false)}).bind("mouseup."+d,function(){c(document).unbind("mousemove."+d+" mouseup."+d)});if(C.stopOnLeave){n.bind("mouseleave."+d+"",function(){c(document).unbind("mousemove."+d+" mouseup."+d)})}}).bind("mouseover",function(){c(this).stop().fadeTo(200,1)}).bind("mouseleave",function(){c(this).stop().fadeTo(200,0.5)});n.unbind("mousewheel."+d).bind("mousewheel."+d,function(F,G,E,D){F.preventDefault();F.stopPropagation();var p=a._limit(t.scrollTop()-48*G,0,B-i);a._setObjScroll.call(n,{scrollTop:p},C.animation,true);a._setScrollHandel.call(n,w,{top:C.margin+p*f},true);return false});x.css({display:"block",left:y+4,height:i-C.margin*2});w.css({display:"block",top:C.margin+t.scrollTop()*f,left:y+4,height:Math.max(1,i*f)})}}if(s>0){var g=(y-C.margin*2)/m,A,z;if(g<1){if(n.children("div.scrollbox-bar-x").length==0){A=c('<div class="scrollbox-bar-x" />').css(k);n.append(A);z=c('<div class="scrollbox-handle-x" />').css(k);n.append(z)}else{A=n.children("div.scrollbox-bar-x").eq(0);z=n.children("div.scrollbox-handle-x").eq(0)}A.unbind("click mouseover mouseleave").bind("click",function(D){var E=D.pageX-c(this).offset().left<z.position().left?-1:1,p=a._limit(t.scrollLeft()+y*E,0,m-y);a._setObjScroll.call(n,{scrollLeft:p},C.animation,true);a._setScrollHandel.call(n,z,{left:C.margin+p*g},false)}).bind("mouseover",function(){c(this).stop().fadeTo(200,0.5)}).bind("mouseleave",function(){c(this).stop().fadeTo(200,0.3)}).css({opacity:0.3});z.unbind("mousedown  mouseover mouseleave").bind("mousedown",function(p){p.preventDefault();var D=p.screenX-z.position().left;c(document).bind("mousemove."+d,function(G){var F=a._limit(G.screenX-D,C.margin,y-C.margin-z.width()),E=a._limit((G.screenX-D)/g,0,m-y);a._setObjScroll.call(n,{scrollLeft:E},C.animation,true);a._setScrollHandel.call(n,z,{left:F},false)}).bind("mouseup."+d,function(){c(document).unbind("mousemove."+d+" mouseup."+d)});if(C.stopOnLeave){n.bind("mouseleave."+d+"",function(){c(document).unbind("mousemove."+d+" mouseup."+d)})}}).bind("mouseover",function(){c(this).stop().fadeTo(200,1)}).bind("mouseleave",function(){c(this).stop().fadeTo(200,0.5)});A.css({display:"block",top:i+4,width:y-C.margin*2});z.css({display:"block",left:C.margin+t.scrollLeft()*g,top:i+4,width:Math.max(1,y*g)})}}if(C.isDraggable){t.unbind("mousedown."+d+" click."+d).bind("click."+d,function(p){if(b>C.minDrag){p.preventDefault();p.stopPropagation()}}).bind("mousedown."+d,function(F){b=0;if(!F.target.nodeName.match(/^(?:a|button|input|textarea)$/im)){F.preventDefault();var G=F.screenY+t.scrollTop(),p=F.screenX+t.scrollLeft(),D=F.screenY,E=F.screenX;c(document).bind("mousemove."+d,function(I){c("body").css("cursor","move");b=Math.max(b,Math.abs(D-I.screenY),Math.abs(E-I.screenX));var H=a._limit(G-I.screenY,0,B-i),J=a._limit(p-I.screenX,0,m-y);a._setObjScroll.call(n,{scrollTop:H,scrollLeft:J},false,true);if(w){a._setScrollHandel.call(n,w,{top:C.margin+H*f},true)}if(z){a._setScrollHandel.call(n,z,{left:C.margin+J*g},true)}if(C.onDragSelect==false){t.css({UserSelect:"none",MozUserSelect:"none"}).attr("unselectable","on")}}).bind("mouseup."+d,function(){c(this).unbind("mouseup."+d+" mousemove."+d);setTimeout(function(){b=0},50);c("body").css("cursor","default");if(C.onDragSelect==false){t.css({UserSelect:"auto",MozUserSelect:"auto"}).attr("unselectable",null)}})}})}n.css(l)}return this},_setObjScroll:function(j,e,f){var i=this,g=this.children("div.scrollbox-container").eq(0);if(e){g.stop().animate(j,200,"linear",function(){if(f){a._trigger.call(i)}})}else{for(var h in j){g[h](j[h])}if(f){a._trigger.call(i)}}},_setScrollHandel:function(f,g,e){if(e){f.stop().animate(g,200,"linear",function(){})}else{f.css(g)}},_limit:function(g,f,e){return Math.max(f,Math.min(e,g))},_trigger:function(){var f=this,e=this.children("div.scrollbox-container").eq(0);if(e.data("scroll_box_trigger_timeout")){clearTimeout(e.data("scroll_box_trigger_timeout"))}e.data("scroll_box_trigger_timeout",setTimeout(function(){f.trigger("scroll",[e.scrollLeft(),e.scrollTop()])},300))},_move:function(h,k){if(a.isSet.call(this)){var i=this,g=i.data("scrollbox_settings"),j=i.children("div.scrollbox-container").eq(0),f=i.children("div.scrollbox-bar-x").eq(0);$scrollBarY=i.children("div.scrollbox-bar-y").eq(0);$scrollHandleX=i.children("div.scrollbox-handle-x").eq(0),$scrollHandleY=i.children("div.scrollbox-handle-y").eq(0),dom=j.get(0),scrollHeight=dom.scrollHeight,clientHeight=dom.clientHeight,scrollWidth=dom.scrollWidth,clientWidth=dom.clientWidth,ratioX=(clientWidth-g.margin*2)/scrollWidth,ratioY=(clientHeight-g.margin*2)/scrollHeight,scroll={},scrollAnimate=false;switch(h){case"toMax":scroll.scrollTop=scrollHeight-clientHeight;scroll.scrollLeft=scrollWidth-clientWidth;scrollAnimate=true;break;case"toMin":scroll.scrollTop=0;scroll.scrollLeft=0;scrollAnimate=true;break;case"scrollBy":scroll.scrollTop=a._limit(j.scrollTop()+parseInt(k[1]),0,scrollHeight-clientHeight);scroll.scrollLeft=a._limit(j.scrollLeft()+parseInt(k[0]),0,scrollWidth-clientWidth);break;case"scrollTo":scroll.scrollTop=a._limit(parseInt(k[1]),0,scrollHeight-clientHeight);scroll.scrollLeft=a._limit(parseInt(k[0]),0,scrollWidth-clientWidth);break;case"setScroll":scroll.scrollTop=a._limit(j.scrollTop(),0,scrollHeight-clientHeight);scroll.scrollLeft=a._limit(j.scrollLeft(),0,scrollWidth-clientWidth);if($scrollBarY.length>0){$scrollBarY.css({display:"block",left:clientWidth+4,height:clientHeight-g.margin*2});$scrollHandleY.css({display:"block",top:g.margin+j.scrollTop()*ratioY,left:clientWidth+4,height:Math.max(1,clientHeight*ratioY)})}if(f.length>0){f.css({display:"block",top:clientHeight+4,width:clientWidth-g.margin*2});$scrollHandleX.css({display:"block",left:g.margin+j.scrollLeft()*ratioX,top:clientHeight+4,width:Math.max(1,clientWidth*ratioX)})}break;case"getScrollById":var e=j.find("#"+k).eq(0);if(e.length>0){return[e.offset().left+j.scrollLeft()-j.offset().left,e.offset().top+j.scrollTop()-j.offset().top]}else{return[null,null]}break;case"scrollToId":var e=j.find("#"+k).eq(0);if(e.length>0){scroll.scrollLeft=a._limit(e.offset().left+j.scrollLeft()-j.offset().left,0,scrollWidth-clientWidth);scroll.scrollTop=a._limit(e.offset().top+j.scrollTop()-j.offset().top,0,scrollHeight-clientHeight);scrollAnimate=true}else{return}break}a._setObjScroll.call(i,scroll,scrollAnimate,true);if($scrollHandleY){a._setScrollHandel.call(i,$scrollHandleY,{top:g.margin+scroll.scrollTop*ratioY},true)}if($scrollHandleX){a._setScrollHandel.call(i,$scrollHandleX,{left:g.margin+scroll.scrollLeft*ratioX},true)}}},getScroll:function(){if(a.isSet.call(this)){var e=this.children("div.scrollbox-container").eq(0);return[e.scrollLeft(),e.scrollTop()]}return[this.scrollLeft(),this.scrollTop()]},setScroll:function(){a._move.call(this,"setScroll");return this},scrollToId:function(e){a._move.call(this,"scrollToId",e);return this},getContents:function(){if(a.isSet.call(this)){return this.children("div.scrollbox-container").eq(0)}return this},getScrollById:function(e){a._move.call(this,"getScrollById",e);return this},toMin:function(){a._move.call(this,"toMin");return this},toMax:function(){a._move.call(this,"toMax");return this},scrollTo:function(e){a._move.call(this,"scrollTo",e);return this},scrollBy:function(e){a._move.call(this,"scrollBy",e);return this},isSet:function(){return this.children("div.scrollbox-container").length>0?true:false},unset:function(){if(!a.isSet.call(this)){return this}var f=this,h=f.children("div.scrollbox-container").eq(0),e=h.scrollTop(),g=h.scrollLeft();f.css({position:f.data("scrollbox_position"),overflow:f.data("scrollbox_overflow")});f.data("scrollbox_settings",null);f.data("scrollbox_position",null);f.data("scrollbox_overflow",null);f.children("div.scrollbox-bar-y, div.scrollbox-handle-y, div.scrollbox-bar-x, div.scrollbox-handle-x").remove();h.children().unwrap();f.scrollTop(e).scrollLeft(g);return this}};c.fn.scrollBox=function(f,e){if(a[f]){return a[f].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof f==="object"||!f){return a.init.apply(this,arguments)}else{c.error("Method "+f+" does not exist on jQuery.scrollbox")}}}})(jQuery);